# Tutorial-2.2-Embedded-Systems-and-IoT-Appliances


Objectives
1.	ควบคุมเครื่องใช้ไฟฟ้าผ่าน dashboard ด้วย relay ได้

Hardware
1.	Touch Sensor          1	        
2.	LED		                x
4.  Solid StateRelay 2CH  1
5.  Resistor 330 ohms     1
4.	Breadboard            1
5.	Computer	            1
6.	microUSB	            1
7.	microcontroller       1   

Software
1. Arduino IDE
--------------------

<h1>lab 2.2 แบ่งออกเป็น 2 เรื่อง ได้แก่ การใช้งาน potentiometer และ relay</h1>
Instruction

<h2>Potentiometer</h2>

เป็นอุปกรณ์อิเล็กทรอนิกส์ประเภทหนึ่ง มีหลายลักษณะการทำงานและการใช้งาน โดยหนึ่งในนั้นจะเป็นแบบที่หมุนได้ทำหน้าที่เป็นตัวต้านทานที่สามารถปรับค่าได้ส่งผลให้ได้ค่าความต้านทานที่ต้องการ

![what-is-potentiometer_3](https://user-images.githubusercontent.com/125423996/219269830-60df34ee-ca69-4e41-8c50-99788d37e086.jpg)
[ภาพจาก riverglennapts.com]
![asdasdsad](https://user-images.githubusercontent.com/125423996/219522043-142f2464-51ba-4b6b-92a0-c2ffe9662d04.JPG)

<h3>สร้างระบบควบคุมหลอดไฟกระแสตรงด้วย potentiometer</h3>

1. ที่ตัว potentiometer ต่อขา GND และ VCC เข้าขา GND และ GPIO 04 ของ ESP32 ตามลำดับ
2. ที่ตัว potentiometer ต่อขา SIG ไปยังขาหนึ่งของตัวต้านทาน
3. ต่อวงจร LED 1 ดวงจากตัวต้านทานและต่อขา GND ให้เรียบร้อย
4. ต่อสายสัญญาณจาก GPIO 36 ไปเชื่อมระหว่างตัวต้านทานและขา SIG
5. เขียนโปรแกรมจากไฟล์ DownLight.ino
6. ทดสอบโปรแกรมโดยปรับระดับที่ตัวหมุนของ potentiometer


--------------------
<h2>Relay</h2>

Relay (รีเลย์) เป็นอุปกรณ์อิเล็กทรอนิกส์ที่ทำหน้าที่เป็นเหมือนสวิชต์เพื่อควบคุมการทำงานของอุปกรณ์ไฟฟ้าอื่นๆ สามารถนำมาใช้เป็นตัวตัดกระแสไฟฟ้าไปเลี้ยงอุปกรณ์ได้ เช่น ระบบเปิด/ปิดเครื่องใช้ไฟฟ้า โดยรีเลย์จะมีการควบคุมการทำงานโดยแบ่งออกเป็น 2 ฝั่ง คือฝั่งควบคุมที่รับค่า input จากไมโครคอนโทรลเลอร์ และฝั่ง output ที่จะทำหน้าที่เป็นสวิชต์ควบคุมอุปกรณ์อื่นๆ ซึ่งรีเลย์ที่นำมาใช้ในวิชานี้จะมีอยู่ 2 ประเภทคือ electromagnetic Relay และ solid state relay


<h3>Electromagnetic Relay</h3>
คือ รีเลย์ที่ทำงานโดยใช้หลักการของสนามแม่เหล็กไฟฟ้าเมื่อได้รับกระแสไฟฟ้า จะมีหน้าสัมผัสและมีเสียงคลิกเวลาทำงาน<br>
- ฝั่ง input จะมี 3 ขาคือ VCC และ GND ทำหน้าที่เป็นไฟเลี้ยงและ ground ให้รีเลย์ทำงาน และขา IN เพื่อรับค่ามาจากไมโครคอนโทรลเลอร์<br>
- ฝั่ง output จะมี 3 ขา  คือ NO, NC, และ Common โดยขา NO ย่อมาจาก Normal Open และ NC ย่อมาจาก Normal close โดยที่ขา NO หมายถึงสถานะที่ relay ไม่ได้รับ input "1" จากไมโครคอนโทรลเลอร์ ขานี้จะมีสถานะ "เปิด" หมายถึงกระแสไฟไม่วิ่งผ่าน ส่วนขา NC หาก relay ไม่ได้รับ input "1" จะมีสถานะ "ปิด" กระแสไฟจะวิ่งผ่าน
<br><br>
หาก relay ได้รับค่า "1 หรือ HIGH" จากไมโครคอนโทรลเลอร์ จะส่งผลให้ขา NO มีสถานะเป็น ปิด และ NC มีสถานะเป็นเปิด ส่งผลให้กระแสไฟที่ก่อนหน้านี้ไม่วิ่งผ่าน NO จะวิ่งผ่านหลังจากได้รับ "HIGH" จากไมโครคอนโทรลเลอร์
<br><br>
สถานะ "เปิด" หรือ "ปิด" มาจากการที่โลหะสองฝั่งสัมผัสหรือไม่สัมผัสกัน โดย "เปิด" หมายถึงไม่สัมผัสทำให้กระแสไฟไม่ไหลผ่าน ส่วน "ปิด" คือสัมผัสกันส่งผลให้กระแสไฟไหลผ่านได้
<br><br>
![sdfsdfsdfdf](https://user-images.githubusercontent.com/125423996/219522596-739e4e98-6796-4952-8fa4-ce29fc6ba3c9.JPG)
[ภาพจาก etechnog.com]

![relay-esp32-wiring](https://user-images.githubusercontent.com/125423996/219270742-3a012498-10bc-4e7e-9985-c47089516265.jpg)
[ภาพจาก randomnerdtutorials.com]

<b>การใช้งาน Electromagnetic Relay ควบคุมเครื่องใช้ไฟฟ้าภายในบ้าน</b>

1. ต่อเซ็นเซอร์อัลตราโซนิกให้รับค่าระยะทางได้ โดยไม่ให้ใช้ GPIO 04 กับเซ็นเซอร์
2. ต่อขา GPIO 04 ไปยังขา IN1 ของรีเลย์
3. ต่อสายไฟและสายดินสำหรับรีเลย์
4. ตัดสายไฟ 1 สายของอุปกรณ์ไฟฟ้า
5. ทำการต่อสายไฟที่ตัดข้างหนึ่งเข้ากับขา Common ของรีเลย์
6. ทำการต่อสายไฟที่ตัดอีกข้างหนึ่งเข้ากับขา NO ของรีเลย์
7. เขียนโปรแกรมโดยตั้งเงื่อนไขหากระยะน้อยกว่า 15cm. ให้ไฟติด และหากระยะเป็นตั้งแต่ 15cm. ขึ้นไปให้ไฟดับ



--------------------

<h3>Solid State Relay</h3>
คือ รีเลย์ที่ทำงานโดยใช้หส่วนประกอบทางอิเล็กทรอนิกส์เข้ามาทำงานซึ่งจะไม่มีหน้าสัมผัสและไม่มีเสียงคลิก ส่งผลให้มีความคงทนต่อการกระแทกเนื่องจากชิ้นส่วนที่เป็นกลไกเชิงกลมีน้อยกว่า รองรับความถี่ได้ดีกว่า<br>
- ฝั่ง input จะมี 3 ขาคือ VCC และ GND ทำหน้าที่เป็นไฟเลี้ยงและขา CH เพื่อรับค่ามาจากไมโครคอนโทรลเลอร์<br>
- ฝั่ง output จะมี 2 ขา เพื่อให้นำสายไฟ 1 เส้นจากเครื่องใช้ไฟฟ้าที่ต้องการควบคุมเข้ามาต่อ โดยหากเป็นไฟฟ้ากระแสสลับ ควรทำสาย Live หรือ Hot มาต่อเพื่อไม่ให้กระแสไฟไหลเข้าอุปกรณ์หากยังไม่ได้เปิด และถ้าเป็นไฟฟ้ากระแสตรงก็ควรทำสายขั้วบวกมาต่อด้วยเหตุผลเดียวกัน ดังนั้นเราสามารถเรียกทั้ง 2 ขาว่าเป็น Live/Hot และ Neutral ได้ ซึ่งขา Neutral คือขาฝั่งที่ยังไม่มีกระแสไฟฟ้านั่นเอง 
<br><br>
โดย solid state relay ที่นำมาใช้ในรายวิชานี้จะเป็นแบบ Low Level หรือ Active Low หมายความว่ารีเลย์จะทำงานก็ต่อเมื่อ input มีค่าเป็น 0 (LOW)
<br><br>
หาก relay ได้รับค่า "0" หรือ "LOW" จากไมโครคอนโทรลเลอร์ จะทำหน้าที่ต่อขาทั้ง 2 ของฝั่ง output ด้วยด้วยกันทำให้กระแสไหลผ่านและเครื่องใช้ไฟฟ้าทำงาน และหากได้สัญญาณเป็น "1" ก็จะทำการตัดวงจรฝั่ง output เพื่อหยุดการทำงานของเครื่องใช้ไฟฟ้า
<br><br>
![5VRELAY4_1024x1024@2x](https://github.com/user-attachments/assets/78a45494-4703-410d-8e8c-f5c760e68b47)
[ภาพจาก scccltd.com]


<b>การใช้งาน Solid State Relay ควบคุมเครื่องใช้ไฟฟ้าภายในบ้าน</b>

1. ออกแบบระบบฝั่ง user เพื่อควบคุมหลอดไฟตามต้องการ เช่น ใช้เซ็นเซอร์ หรือสั่งการผ่าน dashboard
2. ต่อขา GPIO 04 ไปยังขา CH1 ของรีเลย์ ทางฝั่ง input
3. ต่อสายขั้วบวก (vcc) และขั้วลบ (GND) สำหรับรีเลย์
4. ที่อุปกรณ์ไฟฟ้ากระแสสลับ ให้ตัดสายไฟ 1 เส้นของอุปกรณ์ไฟฟ้า
5. นำปลายทั้ง 2 ข้างของสายไฟที่ตัด ต่อเข้ากับขาทั้ง 2 ข้างของรีเลย์ CH1 ฝั่ง output (จากรูปคือ LOAD 1)
6. ดาวน์โหลดโค้ดส่วนของการควบคุมรีเลย์ได้จากไฟล์ solid_state_relay.ino เขียนโปรแกรมเพื่อควบคุมรีเลย์
7. นำโค้ดจากทางฝั่ง user มารวมกับการควบคุมรีเลย์เพื่อให้ระบบสมบูรณ์
